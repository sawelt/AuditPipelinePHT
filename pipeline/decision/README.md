# Decision Maker
This step of the pipeline makes the decision on whether to reject or accept the train based on the results generated by the previous pipeline steps. Below you can find more information about how to configure the decision maker and some examples.


## Configuring the Decisionmaker
When a new is uploaded or an existing train is modified, it has to pass a security audit pipeline.
<img src="/img/PaperRealization.png" width="50%">

At the end of this security audit pipeline is a decision step, that compares the computed scores from each pipeline step to some predefined thresholds and decides whether or not the train is safe to use. These thresholds and the acceptance criteria can be defined by the Train Depot operator in a json file that needs to be located in the root folder of the train depot repository.

### Defining the Decision Tree
The standard Decision Tree is defined as follows:
```
{
    "thresholds": {
        "sast_threshold": 0.5,
        "static_threshold": 0.5,
        "dependency_threshold": 0.5,
        "secret_threshold": 0.5,
        "standard_threshold": 0.5,
        "blacklist_threshold": 0.5,
        "image_threshold": 0.5,
        "dast_threshold": 0.5
    },
    "decision_tree": {
        "sast_score": {
            "operator": ">=",
            "true": {
                "dast_score": {
                    "operator": ">=",
                    "true": true,
                    "false": false
                }
            },
            "false": false
        }
    }
}
```
The json struct needs to contain two keys:
- "thresholds"
	For every score we can define an individual threshold. The standard value is 0.5, but we could increase a certain value if we want to be more strict in that step than with others.
- "decision_tree"
	Here we can define the logic of the decision tree that is used in the decision maker. The decision tree is a dictionary that will be explored recursively. Every subtree of the tree follows the following semantics:
    ```
    {
    	key: {
      	"operator": op,
        "true": t,
        "false": f
      }
    }
    ```
    whereas
    - op $\in \{">=", "<=", ">", "<"\}$
    - t is either $bool$ or a $subtree$
    - f is either $bool$ or a $subtree$
    
In the example from above, the evaluation process looks as follows:
- 1.) Compare sast_score >= sast_threshold
	- 2.) If true, compare dast_score >= dast_threshold
		- 3.) If true, accept and exit
		- 4.) If false, reject and exit
	- 5.) If false, reject and exit

 visualized in a decision tree diagram:
![decision_tree.png](/img/decision_tree.png)

    

    
      	

